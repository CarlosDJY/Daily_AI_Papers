<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœç´¢å†å²å½’æ¡£ - AI è®ºæ–‡ç®€æŠ¥</title>
    <style>
        body {
            font-family: 'åœ†ä½“-ç®€', 'Yuanti SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }
        .header h1 {
            color: #2c3e50;
            margin: 0;
            font-size: 28px;
        }
        .nav-links {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 6px;
        }
        .nav-links a {
            color: #007bff;
            text-decoration: none;
            margin-right: 15px;
            font-size: 14px;
        }
        .nav-links a:hover {
            text-decoration: underline;
        }
        .search-section {
            margin-bottom: 30px;
        }
        .search-box-container {
            position: relative;
            margin-bottom: 15px;
        }
        #search-box {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            box-sizing: border-box;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }
        #search-box:focus {
            outline: none;
            border-color: #007bff;
        }
        #search-status {
            color: #6c757d;
            font-size: 14px;
            margin-bottom: 10px;
            min-height: 20px;
        }
        #search-status.loading {
            color: #007bff;
        }
        #search-status.error {
            color: #dc3545;
        }
        #search-status.success {
            color: #28a745;
        }
        #results-container {
            margin-top: 20px;
        }
        .result-item {
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background-color: #f8f9fa;
            transition: box-shadow 0.3s ease, transform 0.2s ease;
        }
        .result-item:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        .result-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .result-title a {
            color: #007bff;
            text-decoration: none;
        }
        .result-title a:hover {
            text-decoration: underline;
        }
        .result-summary {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        .result-date {
            color: #6c757d;
            font-size: 12px;
            margin-top: 8px;
        }
        .highlight {
            background-color: #ffeb3b;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }
        .no-results {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-size: 16px;
        }
        .no-results-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        .search-hint {
            color: #6c757d;
            font-size: 12px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” æœç´¢å†å²å½’æ¡£</h1>
        </div>
        
        <div class="nav-links">
            <a href="index.html">â† è¿”å›æ±‡æ€»é¡µ</a>
        </div>
        
        <div class="search-section">
            <div class="search-box-container">
                <input type="text" id="search-box" placeholder="è¯·è¾“å…¥å…³é”®è¯æœç´¢ï¼ˆæ”¯æŒå¤šå…³é”®è¯ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼‰..." autocomplete="off" />
                <div class="search-hint">æç¤ºï¼šæ”¯æŒå¤šå…³é”®è¯æœç´¢ï¼Œä¾‹å¦‚ "Kimi transformer"</div>
            </div>
            <div id="search-status">æ­£åœ¨åŠ è½½ç´¢å¼•...</div>
            <div id="results-container"></div>
        </div>
        
        <div class="footer">
            <p>ğŸ“§ è¿™æ˜¯ç”±æ™ºèƒ½è®ºæ–‡ç®€æŠ¥ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„æœç´¢é¡µé¢</p>
        </div>
    </div>
    
    <!-- å¼•å…¥ lunr.js åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let paperDatabase = [];
        let lunrIndex = null;
        
        // åˆå§‹åŒ–æœç´¢åŠŸèƒ½
        async function initSearch() {
            try {
                // åŠ è½½æœç´¢ç´¢å¼•
                const response = await fetch('search_index.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const indexData = await response.json();
                paperDatabase = indexData;
                
                // å°†æ•°æ®å­˜å‚¨åˆ°å…¨å±€å˜é‡ï¼ˆä¾›æœªæ¥è¯­ä¹‰æœç´¢ä½¿ç”¨ï¼‰
                window.paperDatabase = paperDatabase;
                
                // æ„å»º lunr ç´¢å¼•
                lunrIndex = lunr(function() {
                    this.ref('id');
                    this.field('metadata', { boost: 15 });  // metadata æƒé‡æœ€é«˜
                    this.field('abstract', { boost: 10 });  // short_summary æƒé‡ä¸­ç­‰
                    this.field('summary', { boost: 3 });    // è¯¦ç»†æ€»ç»“æƒé‡æœ€ä½
                    
                    // æ·»åŠ æ‰€æœ‰è®ºæ–‡åˆ°ç´¢å¼•
                    paperDatabase.forEach(function(paper) {
                        this.add({
                            id: paper.id,
                            metadata: (paper.metadata || paper.title || ''),  // ä¼˜å…ˆä½¿ç”¨ metadata
                            abstract: (paper.abstract || ''),  // short_summary
                            summary: (paper.summary || '')     // è¯¦ç»†æ€»ç»“
                        });
                    }, this);
                });
                
                // æ›´æ–°çŠ¶æ€
                updateSearchStatus('success', `ç´¢å¼•åŠ è½½å®Œæˆï¼Œå…± ${paperDatabase.length} ç¯‡è®ºæ–‡ï¼Œè¯·è¾“å…¥å…³é”®è¯æœç´¢...`);
                
                // ç»‘å®šæœç´¢äº‹ä»¶
                const searchBox = document.getElementById('search-box');
                searchBox.addEventListener('input', handleSearch);
                searchBox.addEventListener('keyup', handleSearch);
                
            } catch (error) {
                console.error('åŠ è½½æœç´¢ç´¢å¼•å¤±è´¥:', error);
                updateSearchStatus('error', 'åŠ è½½æœç´¢ç´¢å¼•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚');
            }
        }
        
        // æ›´æ–°æœç´¢çŠ¶æ€
        function updateSearchStatus(type, message) {
            const statusEl = document.getElementById('search-status');
            statusEl.textContent = message;
            statusEl.className = type;
        }
        
        // å¤„ç†æœç´¢
        function handleSearch(event) {
            const query = event.target.value.trim();
            
            if (!query) {
                document.getElementById('results-container').innerHTML = '';
                updateSearchStatus('success', `ç´¢å¼•åŠ è½½å®Œæˆï¼Œå…± ${paperDatabase.length} ç¯‡è®ºæ–‡ï¼Œè¯·è¾“å…¥å…³é”®è¯æœç´¢...`);
                return;
            }
            
            if (!lunrIndex) {
                updateSearchStatus('error', 'æœç´¢ç´¢å¼•å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨å€™...');
                return;
            }
            
            try {
                // æ‰§è¡Œæœç´¢
                const results = lunrIndex.search(query);
                
                // è‡ªå®šä¹‰æ’åºï¼šåŒåˆ†æ—¶æŒ‰å…³é”®è¯å‡ºç°æ¬¡æ•°ï¼Œå†æŒ‰ total_score
                const keywords = query.toLowerCase().split(/\s+/).filter(k => k.length > 0);
                const sortedResults = sortSearchResults(results, keywords);
                
                // æ˜¾ç¤ºç»“æœ
                displayResults(sortedResults, query);
                
            } catch (error) {
                console.error('æœç´¢å¤±è´¥:', error);
                updateSearchStatus('error', 'æœç´¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥å…³é”®è¯æ˜¯å¦æ­£ç¡®ã€‚');
                document.getElementById('results-container').innerHTML = '';
            }
        }
        
        // æ’åºæœç´¢ç»“æœï¼ˆåŒåˆ†æ—¶æŒ‰å…³é”®è¯å‡ºç°æ¬¡æ•°ï¼Œå†æŒ‰ total_scoreï¼‰
        function sortSearchResults(results, keywords) {
            // ä¸ºæ¯ä¸ªç»“æœæ·»åŠ é¢å¤–çš„æ’åºä¿¡æ¯
            const enrichedResults = results.map(result => {
                const paper = paperDatabase.find(p => p.id === result.ref);
                if (!paper) return null;
                
                // è®¡ç®—å…³é”®è¯å‡ºç°æ¬¡æ•°
                const searchText = (
                    (paper.metadata || paper.title || '') + ' ' +
                    (paper.abstract || '') + ' ' +
                    (paper.summary || '')
                ).toLowerCase();
                
                let keywordCount = 0;
                keywords.forEach(keyword => {
                    const regex = new RegExp(escapeRegExp(keyword), 'gi');
                    const matches = searchText.match(regex);
                    if (matches) {
                        keywordCount += matches.length;
                    }
                });
                
                return {
                    ...result,
                    keywordCount: keywordCount,
                    totalScore: paper.total_score || 0
                };
            }).filter(r => r !== null);
            
            // æ’åºï¼šå…ˆæŒ‰ lunr åˆ†æ•°ï¼ˆé™åºï¼‰ï¼Œå†æŒ‰å…³é”®è¯å‡ºç°æ¬¡æ•°ï¼ˆé™åºï¼‰ï¼Œå†æŒ‰ total_scoreï¼ˆé™åºï¼‰
            enrichedResults.sort((a, b) => {
                // é¦–å…ˆæŒ‰ lunr ç›¸å…³æ€§åˆ†æ•°ï¼ˆå·²åŒ…å«åœ¨ result.score ä¸­ï¼‰
                if (Math.abs(a.score - b.score) > 0.0001) {
                    return b.score - a.score;
                }
                // åŒåˆ†æ—¶æŒ‰å…³é”®è¯å‡ºç°æ¬¡æ•°
                if (a.keywordCount !== b.keywordCount) {
                    return b.keywordCount - a.keywordCount;
                }
                // ä»ç„¶åŒåˆ†æ—¶æŒ‰ total_score
                return b.totalScore - a.totalScore;
            });
            
            return enrichedResults;
        }
        
        // æ˜¾ç¤ºæœç´¢ç»“æœ
        function displayResults(searchResults, query) {
            const container = document.getElementById('results-container');
            
            if (searchResults.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">ğŸ”</div>
                        <div>æœªæ‰¾åˆ°åŒ¹é…çš„è®ºæ–‡</div>
                        <div style="margin-top: 10px; font-size: 14px;">è¯·å°è¯•å…¶ä»–å…³é”®è¯æˆ–æ£€æŸ¥æ‹¼å†™</div>
                    </div>
                `;
                updateSearchStatus('success', `æœªæ‰¾åˆ°åŒ¹é…ç»“æœï¼ˆå…³é”®è¯: "${query}"ï¼‰`);
                return;
            }
            
            // æ„å»ºç»“æœ HTML
            let html = '';
            const keywords = query.toLowerCase().split(/\s+/).filter(k => k.length > 0);
            
            searchResults.forEach((result, index) => {
                const paper = paperDatabase.find(p => p.id === result.ref);
                if (!paper) return;
                
                // æ ‡é¢˜ï¼šä¼˜å…ˆä½¿ç”¨ metadataï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ title
                const displayTitle = paper.metadata || paper.title || 'æ— æ ‡é¢˜';
                const highlightedTitle = highlightKeywords(displayTitle, keywords);
                
                // æ‘˜è¦ï¼šä¼˜å…ˆä½¿ç”¨ short_summaryï¼ˆå³ abstractï¼‰
                const summaryText = (paper.abstract || '').substring(0, 200);
                const highlightedSummary = highlightKeywords(summaryText, keywords);
                
                html += `
                    <div class="result-item">
                        <div class="result-title">
                            <a href="${paper.report_url}">${highlightedTitle}</a>
                        </div>
                        <div class="result-summary">
                            ${highlightedSummary}${(paper.abstract || '').length > 200 ? '...' : ''}
                        </div>
                        <div class="result-date">æ—¥æœŸ: ${paper.date}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            updateSearchStatus('success', `æ‰¾åˆ° ${searchResults.length} ç¯‡åŒ¹é…çš„è®ºæ–‡ï¼ˆå…³é”®è¯: "${query}"ï¼‰`);
        }
        
        // é«˜äº®å…³é”®è¯
        function highlightKeywords(text, keywords) {
            if (!text || !keywords || keywords.length === 0) {
                return text || '';
            }
            
            let highlighted = text;
            
            // å¯¹æ¯ä¸ªå…³é”®è¯è¿›è¡Œé«˜äº®
            keywords.forEach(keyword => {
                if (keyword.length > 0) {
                    // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
                    const regex = new RegExp(`(${escapeRegExp(keyword)})`, 'gi');
                    highlighted = highlighted.replace(regex, '<span class="highlight">$1</span>');
                }
            });
            
            return highlighted;
        }
        
        // è½¬ä¹‰æ­£åˆ™è¡¨è¾¾å¼ç‰¹æ®Šå­—ç¬¦
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initSearch);
    </script>
</body>
</html>
