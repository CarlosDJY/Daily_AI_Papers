<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœç´¢å†å²å½’æ¡£ - AI è®ºæ–‡ç®€æŠ¥</title>
    <style>
        :root {
            /* é…è‰²æ–¹æ¡ˆï¼šSlate + Indigo */
            --primary-color: #4f46e5;
            --primary-light: #e0e7ff;
            --bg-body: #f8fafc;
            --bg-card: #ffffff;
            --text-main: #1e293b;
            --text-secondary: #64748b;
            --text-light: #94a3b8;
            --border-color: #e2e8f0;
            
            /* é«˜äº®è‰² - æŸ”å’Œçš„é»„ */
            --highlight-bg: #fef9c3;
            --highlight-text: #854d0e;
            
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            
            --font-stack: 'åœ†ä½“-ç®€', 'Yuanti SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-stack);
            background-color: var(--bg-body);
            color: var(--text-main);
            line-height: 1.6;
            padding: 40px 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* å¤´éƒ¨ */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-main);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        /* SVG å›¾æ ‡é€šç”¨æ ·å¼ */
        .icon {
            width: 1em;
            height: 1em;
            display: inline-block;
            vertical-align: middle;
            stroke-width: 2;
            stroke: currentColor;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            margin-bottom: 30px;
            transition: color 0.2s;
        }
        
        .back-link:hover { color: var(--primary-color); }
        .back-link .icon { margin-right: 6px; width: 16px; height: 16px; }

        /* æœç´¢åŒºåŸŸ */
        .search-wrapper {
            position: sticky;
            top: 20px;
            z-index: 100;
            margin-bottom: 40px;
        }

        .search-box-container {
            position: relative;
            max-width: 100%;
        }

        .search-icon-wrapper {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
            pointer-events: none;
            display: flex;
            align-items: center;
        }

        #search-box {
            width: 100%;
            padding: 18px 20px 18px 52px;
            font-size: 16px;
            border: 2px solid transparent;
            border-radius: 16px;
            background-color: var(--bg-card);
            box-shadow: var(--shadow-md);
            font-family: inherit;
            color: var(--text-main);
            transition: all 0.2s ease;
            outline: none;
        }

        #search-box:focus {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-lg);
        }
        
        #search-box::placeholder {
            color: var(--text-light);
        }

        .search-hint {
            margin-top: 12px;
            font-size: 13px;
            color: var(--text-secondary);
            text-align: center;
        }
        
        /* çŠ¶æ€æ  */
        #search-status {
            text-align: center;
            margin-bottom: 20px;
            font-size: 14px;
            color: var(--text-secondary);
            min-height: 24px;
        }

        #search-status.loading { color: var(--primary-color); font-weight: 500; }
        #search-status.error { color: #ef4444; }
        #search-status.success { color: #10b981; }

        /* ç»“æœåˆ—è¡¨ */
        #results-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .result-item {
            background-color: var(--bg-card);
            padding: 24px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .result-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-light);
        }

        .result-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .result-title a {
            color: var(--text-main);
            text-decoration: none;
            background-image: linear-gradient(transparent 90%, var(--primary-light) 0);
            background-size: 100% 10px;
            background-repeat: no-repeat;
            background-position: bottom;
            transition: background-size 0.2s;
        }

        .result-title a:hover {
            background-size: 100% 100%;
            color: var(--primary-color);
        }

        /* å…³é”®è¯ Badge */
        .keywords-container {
            margin-bottom: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .keyword-badge {
            display: inline-block;
            background-color: #f1f5f9;
            color: var(--text-secondary);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }

        /* ä¿®å¤ line-clamp è­¦å‘Š */
        .result-summary {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 12px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            line-clamp: 3; /* æ ‡å‡†å±æ€§ï¼Œæ¶ˆé™¤å…¼å®¹æ€§è­¦å‘Š */
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .result-meta {
            display: flex;
            align-items: center;
            font-size: 12px;
            color: var(--text-light);
            border-top: 1px solid #f1f5f9;
            padding-top: 12px;
            margin-top: 12px;
        }

        /* é«˜äº®æ ·å¼ */
        .highlight {
            background-color: var(--highlight-bg);
            color: var(--highlight-text);
            padding: 0 2px;
            border-radius: 2px;
            font-weight: 600;
        }

        /* ç©ºçŠ¶æ€ */
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .no-results .icon {
            width: 48px;
            height: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
            color: var(--text-secondary);
        }

        /* Footer */
        .footer {
            margin-top: 50px;
            text-align: center;
            color: var(--text-light);
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">
            <svg class="icon" viewBox="0 0 24 24"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
            è¿”å›æ±‡æ€»é¡µ
        </a>
        
        <div class="header">
            <h1>
                <svg class="icon" style="width: 32px; height: 32px; color: var(--primary-color);" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                æœç´¢å†å²å½’æ¡£
            </h1>
        </div>
        
        <div class="search-wrapper">
            <div class="search-box-container">
                <div class="search-icon-wrapper">
                    <svg class="icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </div>
                <input type="text" id="search-box" placeholder="è¾“å…¥å…³é”®è¯ï¼ˆæ”¯æŒå¤šè¯ç©ºæ ¼ï¼‰..." autocomplete="off" />
            </div>
            <div class="search-hint">æ”¯æŒæ ‡é¢˜ã€æ‘˜è¦ã€å…³é”®è¯å…¨æ–‡æ£€ç´¢</div>
        </div>
        
        <div id="search-status">æ­£åœ¨åŠ è½½ç´¢å¼•...</div>
        
        <div id="results-container"></div>
        
        <div class="footer">
            <p>æ™ºèƒ½è®ºæ–‡ç®€æŠ¥ç³»ç»Ÿ Â· æœ¬åœ°å³æ—¶æœç´¢</p>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let paperDatabase = [];
        let lunrIndex = null;
        
        // åˆå§‹åŒ–æœç´¢åŠŸèƒ½
        async function initSearch() {
            try {
                // åŠ è½½æœç´¢ç´¢å¼•
                const response = await fetch('search_index.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const indexData = await response.json();
                paperDatabase = indexData;
                
                window.paperDatabase = paperDatabase;
                
                // æ„å»º lunr ç´¢å¼•
                lunrIndex = lunr(function() {
                    this.ref('id');
                    this.field('metadata', { boost: 15 });
                    this.field('abstract', { boost: 10 });
                    this.field('keywords', { boost: 8 });
                    this.field('summary', { boost: 3 });
                    
                    paperDatabase.forEach(function(paper) {
                        this.add({
                            id: paper.id,
                            metadata: (paper.metadata || paper.title || ''),
                            abstract: (paper.abstract || ''),
                            keywords: (paper.keywords || ''),
                            summary: (paper.summary || '')
                        });
                    }, this);
                });
                
                updateSearchStatus('success', `ç´¢å¼•åŠ è½½å®Œæˆï¼Œå…± ${paperDatabase.length} ç¯‡è®ºæ–‡`);
                
                // ç»‘å®šäº‹ä»¶
                const searchBox = document.getElementById('search-box');
                searchBox.addEventListener('input', handleSearch);
                searchBox.addEventListener('keyup', handleSearch);
                searchBox.focus(); // è‡ªåŠ¨èšç„¦
                
            } catch (error) {
                console.error('åŠ è½½æœç´¢ç´¢å¼•å¤±è´¥:', error);
                updateSearchStatus('error', 'åŠ è½½æœç´¢ç´¢å¼•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚');
            }
        }
        
        function updateSearchStatus(type, message) {
            const statusEl = document.getElementById('search-status');
            statusEl.textContent = message;
            statusEl.className = type;
            
            // 3ç§’åæ·¡å‡ºæˆåŠŸä¿¡æ¯
            if (type === 'success') {
                setTimeout(() => {
                    if (statusEl.className === 'success') statusEl.textContent = '';
                }, 3000);
            }
        }
        
        function handleSearch(event) {
            const query = event.target.value.trim();
            
            if (!query) {
                document.getElementById('results-container').innerHTML = '';
                updateSearchStatus('', '');
                return;
            }
            
            if (!lunrIndex) return;
            
            try {
                const results = lunrIndex.search(query);
                const keywords = query.toLowerCase().split(/\s+/).filter(k => k.length > 0);
                const sortedResults = sortSearchResults(results, keywords);
                displayResults(sortedResults, query);
            } catch (error) {
                console.error('æœç´¢å¤±è´¥:', error);
            }
        }
        
        function sortSearchResults(results, keywords) {
            const enrichedResults = results.map(result => {
                const paper = paperDatabase.find(p => p.id === result.ref);
                if (!paper) return null;
                
                const searchText = (
                    (paper.metadata || paper.title || '') + ' ' +
                    (paper.abstract || '') + ' ' +
                    (paper.summary || '')
                ).toLowerCase();
                
                let keywordCount = 0;
                keywords.forEach(keyword => {
                    // ç®€å•çš„å‡ºç°æ¬¡æ•°ç»Ÿè®¡
                    const matches = searchText.split(keyword.toLowerCase()).length - 1;
                    keywordCount += matches;
                });
                
                return {
                    ...result,
                    keywordCount: keywordCount,
                    totalScore: paper.total_score || 0
                };
            }).filter(r => r !== null);
            
            // æ’åºè§„åˆ™ï¼šLunråˆ†æ•° > å…³é”®è¯é¢‘æ¬¡ > è®ºæ–‡æ¨èåˆ†
            enrichedResults.sort((a, b) => {
                if (Math.abs(a.score - b.score) > 0.001) return b.score - a.score;
                if (a.keywordCount !== b.keywordCount) return b.keywordCount - a.keywordCount;
                return b.totalScore - a.totalScore;
            });
            
            return enrichedResults;
        }
        
        function displayResults(searchResults, query) {
            const container = document.getElementById('results-container');
            
            if (searchResults.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="8" y1="12" x2="16" y2="12"></line></svg>
                        <div>æœªæ‰¾åˆ°ä¸ "${query}" ç›¸å…³çš„ç»“æœ</div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            const keywords = query.toLowerCase().split(/\s+/).filter(k => k.length > 0);
            
            searchResults.forEach(result => {
                const paper = paperDatabase.find(p => p.id === result.ref);
                if (!paper) return;
                
                const displayTitle = paper.metadata || paper.title || 'æ— æ ‡é¢˜';
                const highlightedTitle = highlightKeywords(displayTitle, keywords);
                const summaryText = (paper.abstract || '').substring(0, 240);
                const highlightedSummary = highlightKeywords(summaryText, keywords);
                
                let keywordsHTML = '';
                if (paper.keywords_list && paper.keywords_list.length > 0) {
                    keywordsHTML = '<div class="keywords-container">';
                    paper.keywords_list.slice(0, 5).forEach(keyword => { // é™åˆ¶æ˜¾ç¤º5ä¸ªå…³é”®è¯
                        const highlightedKeyword = highlightKeywords(keyword, keywords);
                        keywordsHTML += `<span class="keyword-badge">${highlightedKeyword}</span>`;
                    });
                    keywordsHTML += '</div>';
                }
                
                html += `
                    <div class="result-item">
                        <div class="result-title">
                            <a href="${paper.report_url}">${highlightedTitle}</a>
                        </div>
                        ${keywordsHTML}
                        <div class="result-summary">
                            ${highlightedSummary}${(paper.abstract || '').length > 240 ? '...' : ''}
                        </div>
                        <div class="result-meta">
                            <span>ğŸ“… ${paper.date}</span>
                            <span style="margin: 0 8px">â€¢</span>
                            <span>æ¨èåˆ†: ${parseFloat(paper.total_score || 0).toFixed(3)}</span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function highlightKeywords(text, keywords) {
            if (!text || !keywords || keywords.length === 0) return text || '';
            let highlighted = text;
            keywords.forEach(keyword => {
                if (keyword.length > 0) {
                    const regex = new RegExp(`(${escapeRegExp(keyword)})`, 'gi');
                    highlighted = highlighted.replace(regex, '<span class="highlight">$1</span>');
                }
            });
            return highlighted;
        }
        
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
        
        document.addEventListener('DOMContentLoaded', initSearch);
    </script>
</body>
</html>